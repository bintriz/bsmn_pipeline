bsmn-pipeline implements various cluster jobs, arranged for genome alignment, variant calling and variant filtering.

Getting the bsmn pipeline
=========================

    git clone https://github.com/bsmn/bsmn-pipeline.git

Creating an environment from YAML file
======================================

This step depend on the conda which is a tool for installling and managing dependencies.
You need to install conda first (https://docs.conda.io/en/latest/miniconda.html).

To create a new conda environment from the given environment.yml file, run:

    conda env create -f /path/to/environment.yml 

By default, the name of environment will be 'bp'. you can change it by adding a '-n <name>' option to the command above.

Installing ucsc packages
========================

ucsc-* packages were excluded from the environment file because of conflicting with root.
Here you need to install those packages by running commands as follows:

    conda install -n bp ucsc-fetchchromsizes ucsc-bigwigaverageoverbed ucsc-wigtobigwig ucsc-liftover

Building CNVnator
=================

To build and install CNVnator, activate the 'bp' environment and type the following commands:

    conda activate bp # Make sure you've activated the environment you created.
    cd $CONDA_PREFIX # Within the environment directory
    git clone https://github.com/yjjang/CNVnator.git
    cd CNVnator
    wget https://github.com/samtools/samtools/releases/download/1.10/samtools-1.10.tar.bz2
    tar xjf samtools-1.10.tar.bz2 && mv samtools-1.10 samtools
    cd samtools
    ./configure && make -j 8
    cd ..
    make YEPPPLIBDIR=../lib YEPPPINCLUDEDIR=../include/yeppp
    cd $CONDA_PREFIX/bin && ln -s ../CNVnator/cnvnator

Installing MosaicForecast
=========================

For the reproducibility and consistency, it is recommended to checkout the specific revision as below.

    cd $CONDA_PREFIX # Within the environment directory (optional, any directory would be fine)
    git clone https://github.com/parklab/MosaicForecast.git
    cd MosaicForecast
    git checkout 63d8e60

Resources
=========

google-cloud-sdk and crcmod
---------------------------

    conda activate bp # Make sure you've activated the environment you created.
    pip3 install --no-cache-dir -U crcmod
    gsutils version -l # You should see the 'compiled crcmod: True'
    conda deactivate

Start downloading
-----------------

TODO

Configuring the pipeline
========================

TODO

Running the pipeline
====================

Align raw reads (fastq) to genome (b37, hg19 or hg38)

    python3 /path/to/pipeline/jobs/run_genome_mapping.py -q 4-day -r hg19 -f bam --target-seq -p 50 --run-filters --skip-cnvnator


